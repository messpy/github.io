<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Markdown Viewer</title>
<style>
body { font-family: system-ui; margin:20px; }
textarea { width:100%; height:200px; }
#preview { border:1px solid #ccc; padding:10px; margin-top:10px; }
button { margin-right:8px; }
</style>
</head>
<body>

<h1>Markdown Upload Preview</h1>

<input type="file" id="fileInput" accept=".md">
<button onclick="exportHTML()">HTMLエクスポート</button>

<textarea id="editor"></textarea>
<div id="preview"></div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>

<script>
const editor = document.getElementById("editor");
const preview = document.getElementById("preview");

function render() {
  const raw = marked.parse(editor.value);
  preview.innerHTML = DOMPurify.sanitize(raw);
}

editor.addEventListener("input", render);

document.getElementById("fileInput").addEventListener("change", function(e){
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(ev){
    editor.value = ev.target.result;
    render();
  };
  reader.readAsText(file);
});

function exportHTML(){
  const html = preview.innerHTML;
  const blob = new Blob([html], {type:"text/html"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "export.html";
  a.click();
  URL.revokeObjectURL(url);
}

render();
</script>

</body>
</html>
